# Replication Package

## Transferable Development Rights and the Urban–Rural Income Divide: Evidence from China's Land Coupon Program

Ma, Sexton, and Zhong

---

## Overview

This folder contains the data and code to replicate all empirical analyses reported in the paper, including county-level econometric analysis (event-study DiD, TWFE, Callaway & Sant'Anna and Sun & Abraham heterogeneity-robust estimation, robustness checks, and mechanism tests), provincial-level synthetic control methods, Theil-index decompositions, and multiplier simulations.

## Requirements

### Python (county-level analysis)

- **Python** 3.9 or later
- **Python packages:**
  - `pandas` (≥ 1.5)
  - `numpy` (≥ 1.22)
  - `pyfixest` (≥ 0.25) — fixed-effects estimation and wild cluster bootstrap
  - `matplotlib` (≥ 3.5) — figures
  - `scipy` (≥ 1.9) — statistical tests
  - `openpyxl` (≥ 3.0) — reading Excel files
  - `csdid` (==0.3.0) — Callaway & Sant'Anna (2021) estimator
  - `drdid` (==0.1.0) — doubly robust DiD (dependency of csdid)
  - `wildboottest` (≥ 0.3) — wild cluster bootstrap inference

Install all Python dependencies:

```bash
pip install pandas numpy pyfixest matplotlib scipy openpyxl csdid drdid wildboottest
```

### R (provincial-level and decomposition analyses)

- **R** 4.0 or later
- **R packages:** `Synth`, `tidyverse`, `readxl`, `ggplot2`

## Folder Structure

```
replication/
├── README.md                              ← This file
├── plot_style.py                          ← Shared plotting style and helpers
├── 01_data_preparation.py                 ← Data loading and preparation
├── 02_main_analysis.py                    ← Event study, TWFE, treatment intensity
├── 03_robustness_and_mechanisms.py        ← Robustness checks and mechanisms
├── 04_cs_estimator.py                     ← CS (2021) and SA (2021) estimators
├── 05_extended_panel.py                   ← Extended panel (2005–2020) robustness
├── 06_rural_income.py                     ← Rural income event study (Appendix)
├── 07_national_figure.py                  ← National income ratio figure (Figure 1)
├── 08_participation_model.py              ← Selective participation model (Section 6.4)
├── china_urban_rural_income_2005_2020.xlsx ← National income data for Figure 1
├── data/
│   ├── Chongqing.xlsx                     ← Source county-level panel data (2009–2020)
│   ├── Chongqing_expanded.xlsx            ← Extended panel data (2005–2020)
│   └── county_panel.csv                   ← Prepared dataset (generated by 01)
├── SCM_MASC_analysis/                     ← Provincial synthetic control (R)
│   ├── SC&Matching_final_test.Rmd         ← SCM and MASC estimation
│   ├── SCM_test.xlsx                      ← Provincial panel data
│   └── *.csv, *.png                       ← Results and figures
├── Theil_index_calculation(Chongqing)/    ← Theil decomposition (R)
│   ├── theil_analysis.Rmd                 ← Theil index computation
│   ├── Chongqing.xlsx                     ← County income data
│   └── *.csv, *.png                       ← Results and figures
├── Multiplier Effect Analysis/            ← Multiplier simulation (R)
│   ├── multiplier_effect.Rmd              ← Multiplier scenario analysis
│   ├── *.xlsx                             ← Input data
│   └── *.png                              ← Simulation figures
└── output/                                ← Generated by Python scripts
    ├── event_study_results.csv
    ├── event_study_results_controls.csv
    ├── cohort_specific_att.csv
    ├── cs_event_study_results.csv
    ├── cs_aggregate_results.txt
    ├── sa_event_study_results.csv
    ├── sa_event_study_results_controls.csv
    ├── figures/
    │   ├── event_study_main.png / .pdf
    │   ├── cs_event_study.png / .pdf
    │   ├── cs_sa_comparison.png / .pdf
    │   ├── bacon_decomposition.png
    │   ├── income_decomposition_event_study.png / .pdf
    │   ├── event_study_extended.png / .pdf
    │   ├── event_study_rural_income.png / .pdf
    │   └── China_urban_rural_ratio_figure.png / .pdf
    └── tables/
        ├── table_main_did.tex
        ├── table_cs_sa_summary.tex
        ├── table_cohort_att.tex
        ├── table_robustness.tex
        ├── table_balance.tex
        ├── table_mechanism_income.tex
        ├── table_participation.tex
        ├── table_loo.tex
        └── table_rural_income.tex
```

## How to Replicate

### County-level analysis (Python)

Run the scripts **in order** from the `replication/` directory:

```bash
cd replication
python 01_data_preparation.py
python 02_main_analysis.py
python 03_robustness_and_mechanisms.py
python 04_cs_estimator.py
python 05_extended_panel.py
python 06_rural_income.py
python 07_national_figure.py
python 08_participation_model.py
```

Each script prints its key results to the console and saves outputs to the `output/` folder.

### Provincial-level analysis (R)

Open and knit each R Markdown file in its respective subdirectory:

- `SCM_MASC_analysis/SC&Matching_final_test.Rmd` → SCM, MASC, and placebo tests (Section 7.1; Figures 8, A.1; Table A.5)
- `Theil_index_calculation(Chongqing)/theil_analysis.Rmd` → Theil-index decomposition (Section 6.1; Figure 5)
- `Multiplier Effect Analysis/multiplier_effect.Rmd` → Multiplier simulation (Section 7.2; Figure 7)

## Script Descriptions

### `01_data_preparation.py`
Loads the raw county-level panel data (`Chongqing.xlsx`), identifies treatment cohorts by the year of each county's first land coupon transaction, constructs analysis variables (binary treatment indicator, relative time, log controls), reports panel diagnostics, and saves the prepared dataset to `data/county_panel.csv`.

### `02_main_analysis.py`
Estimates the core results:
- **Event-study DiD** (Equation 2 in the paper): coefficients for relative time −4 through +10, with and without time-varying controls. Generates the TWFE event study figure (Appendix Figure A.2).
- **Pooled staggered DiD** (Equation 3): binary treatment (columns 1–2), log annual transaction intensity (columns 3–4), and log cumulative transaction intensity (columns 5–6). Generates Table A.1 in LaTeX.

### `03_robustness_and_mechanisms.py`
- **Goodman-Bacon decomposition**: decomposes the TWFE estimate into "treated vs. never-treated" and "early vs. late" 2×2 comparisons. Generates Figure A.3.
- **Cohort-specific ATTs**: separate DiD for each treatment cohort vs. never-treated (Table 5).
- **Alternative specifications**: excluding the 2009 cohort, 2011+ cohorts only, excluding the 2011 cohort (largest), extended controls, and log specification (Table 6).
- **Leave-one-out sensitivity**: drops each of the 6 never-treated counties in turn (Appendix Table A.2).
- **Wild cluster bootstrap**: reports WCB p-values for key specifications to address inference with 37 clusters.
- **Income decomposition**: event studies for log rural income and log urban income separately (Figure 5).
- **Baseline balance table**: comparing treated vs. never-treated counties at baseline (Table 3).
- **Income mechanism table**: pooled TWFE for log rural and urban income separately (Table A.1).

### `04_cs_estimator.py`
Implements both heterogeneity-robust estimators:
- **Callaway & Sant'Anna (2021)**: doubly robust group-time ATT(g,t) estimates, simple/dynamic/group aggregate ATTs. Generates the CS event-study figure (Figure 2).
- **Sun & Abraham (2021)**: interaction-weighted event-study estimates with and without controls, using cohort-specific regressions against never-treated counties. The 2009 cohort is excluded from both estimators.
- **CS vs. SA comparison figure** (Figure 3): side-by-side event-study plots.
- **Summary table** (Table 2): dynamic ATTs from both estimators.

### `05_extended_panel.py`
Extends the panel back to 2005 using `Chongqing_expanded.xlsx` to provide pre-treatment observations for the 2009 cohort:
- **Extended event study**: event-study DiD on the unbalanced 2005–2020 panel (504 obs).
- **Comparison figure**: side-by-side event-study plots comparing balanced and extended panels (Figure 6).

### `06_rural_income.py`
Comprehensive event study of the program's effect on rural disposable income (log), reported as Appendix Section C:
- **TWFE event study** on balanced and extended panels for log rural income.
- **Callaway & Sant'Anna doubly robust** event-study aggregation and overall ATT.
- Generates the 3-panel event-study figure and pooled results table (Table A.3).

### `07_national_figure.py`
Generates Figure 1: national urban and rural per capita disposable income with the income ratio overlay, marking the 2008 LCP launch.

### `08_participation_model.py`
Estimates the two-part participation model (Section 6.4):
- Part 1: Linear probability model for annual participation (positive transaction area).
- Part 2: OLS for log cumulative transaction area, conditional on participation.
- Both parts regress on baseline income ratio, fiscal revenue, and urbanization rate with year fixed effects.

## Data Description

`Chongqing.xlsx` contains a balanced panel of 37 Chongqing counties over 12 years (2009–2020), totaling 444 observations. Key variables:

| Variable | Description |
|---|---|
| `county_id` | County identifier |
| `year` | Calendar year (2009–2020) |
| `urban_rural_income_ratio` | Ratio of urban to rural per capita disposable income |
| `mu_u` | Urban per capita disposable income (RMB) |
| `mu_r` | Rural per capita disposable income (RMB) |
| `ticket_area` | Annual land coupon transaction area (10,000 m²) |
| `ticket_cum` | Cumulative land coupon transaction area (10,000 m²) |
| `gdp_pc` | GDP per capita (RMB) |
| `fiscal_rev` | Fiscal revenue (10,000 RMB) |
| `urbanization_rate` | Urban population share (%) |

## Mapping: Scripts → Paper Elements

| Paper Element | Script | Output File |
|---|---|---|
| Figure 1: National income ratio | `07_national_figure.py` | `China_urban_rural_ratio_figure.png` |
| Table 1: County summary stats | `01_data_preparation.py` | Console output |
| Table 2: CS/SA summary | `04_cs_estimator.py` | `table_cs_sa_summary.tex` |
| Figure 2: CS event study | `04_cs_estimator.py` | `cs_event_study.png` |
| Figure 3: CS vs. SA comparison | `04_cs_estimator.py` | `cs_sa_comparison.png` |
| Table 3: Baseline balance | `03_robustness_and_mechanisms.py` | `table_balance.tex` |
| Table 4: Main TWFE | `02_main_analysis.py` | `table_main_did.tex` |
| Table 5: Cohort ATTs | `03_robustness_and_mechanisms.py` | `table_cohort_att.tex` |
| Table 6: Robustness | `03_robustness_and_mechanisms.py` | `table_robustness.tex` |
| Figure 4: Bacon decomposition | `03_robustness_and_mechanisms.py` | `bacon_decomposition.png` |
| Figure 5: Income decomposition | `03_robustness_and_mechanisms.py` | `income_decomposition_event_study.png` |
| Theil decomposition (Sec. 6.1) | `Theil_index_calculation/` | `theil_decomposition_over_years.png` |
| Participation model (Sec. 6.4) | `08_participation_model.py` | `table_participation.tex` |
| Figure 6: Extended panel | `05_extended_panel.py` | `event_study_extended.png` |
| SCM/MASC (Sec. 7.1) | `SCM_MASC_analysis/` | `first-case-MASC.png`, etc. |
| Multiplier (Sec. 7.2) | `Multiplier Effect Analysis/` | `multiplier_*.png` |
| App. A: TWFE benchmark | `02_main_analysis.py` | `event_study_main.png` |
| App. C: Rural income | `06_rural_income.py` | `event_study_rural_income.png` |
| App. Table A.2: LOO | `03_robustness_and_mechanisms.py` | `table_loo.tex` |

## Notes

- The analysis uses **pyfixest** for fixed-effects regression with clustered standard errors. The event-study specification uses `i(rel_time, ref=-1)` syntax to estimate coefficients for each relative time period, with period −1 as the omitted reference.
- Never-treated counties (6 out of 37) serve as the control group throughout and are assigned to the reference period for the event study.
- Treatment cohorts are defined by the first year in which a county has a positive land coupon transaction (`ticket_area > 0`). There are 14 counties first treated in 2009, 6 in 2010, 8 in 2011, 1 in 2012, 1 in 2014, and 1 in 2017.
- The Callaway & Sant'Anna (2021) estimator uses the `csdid` Python package with doubly robust estimation and the not-yet-treated control group. It automatically drops the 2009 cohort and provides simultaneous confidence bands via the multiplier bootstrap.
- The Sun & Abraham (2021) interaction-weighted estimator is implemented via cohort-specific event-study regressions aggregated using cohort-size weights, excluding the 2009 cohort and using never-treated counties as the comparison group.
- Wild cluster bootstrap inference (Cameron, Gelbach, and Miller, 2008) is implemented via the `wildboottest` package to address potential under-rejection with 37 clusters.
- Provincial-level SCM/MASC analysis, Theil-index decomposition, and multiplier simulations are implemented in R Markdown and located in their respective subdirectories.
